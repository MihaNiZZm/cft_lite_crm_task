# LiteCRM

Spring Boot RESTful-приложение для управления продавцами и транзакциями.

## Содержание
1. [**Overview**](#overview)
2. [**Сборка и запуск**](#сборка-и-запуск)
3. [**Тестирование**](#тестирование)
4. [**Комментарии от разработчика**](#комментарии-от-разработчика)

## Overview

### Описание функций приложения
Веб-приложение **LiteCRM** создано в рамках выполнения тестового задания для лаборатории ШИФТ.
Приложение позволяет выполнять операции над продавцами и транзакциями, а также получать
некую аналитику по результатам работы системы. Приложение поддерживает следующие API-методы:

- Создать продавца
- Получить список всех продавцов
- Получить продавца по ID
- Изменить продавца по ID
- Удалить продавца по ID
- Получить список всех транзакций продавца по ID
- Создать транзакцию
- Получить список всех транзакций
- Получить транзакцию по ID
- Изменить транзакцию по ID
- Удалить транзакцию по ID
- Получить самого продуктивного продавца
- Получить список продавцов с суммой меньше указанной
- Получить самый продуктивный день выбранного продавца

### Использованные технологии
В ходе выполнения проекта были использованы такие технологии как:
- **Docker** (для развертывания приложения и базы данных в контейнерах)
- **SpringBoot** (фреймворк для разработки backend-приложения)
- **JUnit**, **Mockito**, **MockMvc**, **jacoco**, **Testcontainers** (для тестирования)
- **PostgreSQL** (в качестве реляционной БД)
- **Lombok** (для генерации конструкторов, геттеров и сеттеров)
- **MapStruct** (для улучшенного маппинга бинов в DTO и наоборот)
- **Swagger** (для документации API)
- **Flyway** (для миграций БД)
- **Hibernate Envers** (для версионирования сущностей БД)
- **Hibernate Validator** (для валидации полей сущностей)

### Примеры использования API
Протестировать API наглядно с UI можно на странице Swagger, собрав и запустив проект.

Пример использования API:

```GET /api/v1/sellers/{id}``` - получить информацию о продавце по ID

**Успешный ответ (если продавец с таким ID нашелся)**

Статус-код: 200 ОК

Тело ответа в формате JSON:

```json
{
    "id": 1,
    "name": "MihaNiZZm",
    "contactInfo": "mihanizzm22@gmail.com",
    "registrationDate": "2025-02-17T00:00:00.000"
}
```

**Ответ с ошибкой (если продавец с таким ID не нашелся)**

Статус-код: 404 NOT FOUND

Тело ответа ошибки (строка):

```
SellerNotFoundException handled: couldn't find seller with id: {id}
```

Вместо {id} будет выведен идентификатор пользователя из запроса. 

## Сборка и запуск


Для сборки и запуска проекта вам понадобятся следующие инструменты на вашем ПК:
- [**Docker**](https://www.docker.com/)
- [**JDK21 (необязательно)**](https://www.oracle.com/java/technologies/javase/jdk21-archive-downloads.html)

Docker используется для создания контейнеров для базы данных и бэкенда, JDK21 используется
при ручном запуске бэкенда локально и для прогона тестов с проверкой покрытия. Рекомендуется
собирать проект исключительно используя Docker, если Вы хотите использовать его
по назначению(без прогона тестов).

Ниже представлены инструкции по сборке и запуску проекта, используя 2 разных способа:
1. [**Всё в Docker**](#всё-в-docker)
2. [**БД в Docker, backend локально**](#бд-в-docker-backend-локально)

### Всё в Docker
Для запуска приложения используя Docker, сначала убедитесь, что процессы на Вашем устройстве
не занимают порты **5432** и **8080**, т.к. они используются для базы данных и сервера бэкенд приложения.
Если эти порты используются, завершите процессы, занимающие эти порты (выключите PostgreSQL
Server или сервера, которые занимают порт 8080).

После этого собираем проект используя командную строку:
```bash
docker-compose up --build -d
```

После сборки и запуска, приложение будет размещено по адресу http://localhost:8080/ и будет
ожидать запросов. Сама страница http://localhost:8080/ является пустой, однако Вы можете
посмотреть API-документацию с UI, перейдя на страницу Swagger по адресу:
http://localhost:8080/swagger-ui/index.html. Если адрес страницы не приводит Вас к документации,
возможно, приложение хостится на другом адресе. Найти точный адрес API-документации можно в
логах контейнера бэкенда под баннером сразу после запуска.

### БД в Docker, backend локально
Для запуска БД в Docker, а backend отдельно, сначала убедитесь, что процессы на Вашем устройстве
не занимают порты **5432** и **8080**, т.к. они используются для базы данных и сервера бэкенд приложения.
Если эти порты используются, завершите процессы, занимающие эти порты (выключите PostgreSQL
Server или сервера, которые занимают порт 8080).

Поднимаем базу данных используя командную строку, для этого перейдите в папку, 
где находится проект и в командной строке введите следующую команду:
```bash
docker-compose up -d lite_crm_database
```

Запускаем бэкенд локально. Можем использовать командную строку, или IntellijIdea.

#### Командная строка
Для запуска бэкенда через командную строку перейдите в корневую папку проекта и введите следующую
команды:
```bash
./gradlew bootRun
```

#### IntellijIdea
Для запуска бэкенда, используя IntellijIdea, откройте папку проекта в IntellijIdea. Скорее всего,
IDE сама найдет файл build.gradle и создаст необходимые конфигурации для запуска. После этого запустите
приложение используя стандартную конфигурацию запуска.

После запуска приложения Вы увидите логи запуска и сможете пользоваться
приложением. Приложение будет размещено по адресу http://localhost:8080/ и будет
ожидать запросов. Сама страница http://localhost:8080/ является пустой, однако Вы можете
посмотреть API-документацию с UI, перейдя на страницу Swagger по адресу:
http://localhost:8080/swagger-ui/index.html. Если адрес страницы не приводит Вас к документации,
возможно, приложение хостится на другом адресе. Найти точный адрес API-документации можно в
логах приложения под баннером сразу после запуска.

## Тестирование

Для прогона тестов и получения отчета по проценту покрытия кода,
откройте командную строку в корневой папке проекта и выполните следующую команду:

```bash
./gradlew test
```

После выполнения команды Вы сможете найти отчет тестирования в папке
```./build/reports/jacoco/test/html```

В данной папке откройте файл ```index.html``` любым удобным для Вас браузером.
На открывшейся странице Вы сможете посмотреть и проанализировать отчет по
тестированию.

## Комментарии от разработчика

В данном разделе хотелось бы рассказать о том, что я не успел сделать, что можно
улучшить и какие эмоции и опыт подарило мне это небольшое тестовое
задание.

Что я не успел и что можно было сделать лучше:
1. Я не успел дописать тест-кейсы для некоторых ветвей исполнения для сервисов
2. Не написал тесты на методы хэндлера исключение
3. Можно было бы сделать получше вывод и обработку исключений, но я сделал их
на минимально достаточном для себя уровне
4. Можно было написать больше различных тестов для репозиториев

В остальном, с моей точки зрения, проект выглядит достаточно неплохо! :)
К сожалению, я увидел письмо о том, что нужно делать тестовое задание только
через 3 дня, как оно пришло. По этой причине на выполнение задания у меня
оставалось чуть больше трех дней. Все эти три дня я почти безвылазно сидел и
писал это приложение. 

Я разобрался в тестировании Spring Boot приложений, 
научился лучше размечать Swagger документацию и в очередной раз попрактиковался
с Докером, с миграциями БД, с написанием SQL-запросов и в целом с работой со
Spring Framework. Очень много практики получилось по мапперам: приходилось
использовать и именованные методы, и дефолтные реализации методов в интерфейсе.

Возможно, в каких-то местах можно найти дублирование кода или еще какие-то не
самые лучшие практики, но у меня попросту не было достаточно времени, чтобы
идеально написать такой достаточно большой по количеству файлов проект за три дня.
В целом, я старался придерживаться принципов SOLID, не делать огромные классы с 
кучей методов. Должное внимание я уделил Dependency Inversion принципу, поэтому
в коде так много интерфейсов.

Больше всего опыта я получил в области тестирования. Пришлось повозиться с
мокированием, с тест-контейнерами и с тестами на взаимодействие с БД. В итоге
все получилось достаточно неплохо, хоть и времени на тесты было потрачено очень
много.

Пока что на этом все. Мне нужно заливать этот проект на гитхаб и записывать 
видео-визитку. Спасибо за Ваше внимание и интерес к проекту! :)
